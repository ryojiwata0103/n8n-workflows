<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Workflow Localization Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .card { background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; overflow: hidden; }
        .card-header { background: #f8f9fa; padding: 20px; border-bottom: 1px solid #dee2e6; }
        .card-body { padding: 20px; }
        .btn { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .api-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .api-section { grid-template-columns: 1fr; } }
        .json-display { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; font-family: 'Courier New', monospace; white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ n8n Workflow Localization Platform</h1>
            <p>n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç¿»è¨³ãƒ»ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
        </div>

        <!-- APIæ¥ç¶šãƒ†ã‚¹ãƒˆ -->
        <div class="card">
            <div class="card-header">
                <h3>ğŸ“¡ APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
            </div>
            <div class="card-body">
                <button class="btn" onclick="testAPI()">APIã‚µãƒ¼ãƒãƒ¼æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testLanguages()">ã‚µãƒãƒ¼ãƒˆè¨€èªä¸€è¦§å–å¾—</button>
                <div id="api-status"></div>
                <div id="api-result" class="json-display" style="display: none;"></div>
            </div>
        </div>

        <div class="api-section">
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² -->
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</label>
                        <input type="text" id="reg-username" placeholder="testuser">
                    </div>
                    <div class="form-group">
                        <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
                        <input type="email" id="reg-email" placeholder="test@example.com">
                    </div>
                    <div class="form-group">
                        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                        <input type="password" id="reg-password" placeholder="password123">
                    </div>
                    <button class="btn btn-success" onclick="registerUser()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</button>
                    <div id="register-status"></div>
                </div>
            </div>

            <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
                        <input type="email" id="login-email" placeholder="test@example.com">
                    </div>
                    <div class="form-group">
                        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                        <input type="password" id="login-password" placeholder="password123">
                    </div>
                    <button class="btn btn-success" onclick="loginUser()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    <div id="login-status"></div>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º -->
        <div class="card" id="profile-section" style="display: none;">
            <div class="card-header">
                <h3>ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
            </div>
            <div class="card-body">
                <button class="btn" onclick="getProfile()">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—</button>
                <div id="profile-status"></div>
                <div id="profile-result" class="json-display" style="display: none;"></div>
            </div>
        </div>

        <!-- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <div class="card" id="upload-section" style="display: none;">
            <div class="card-header">
                <h3>ğŸ“„ n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>n8n JSONãƒ•ã‚¡ã‚¤ãƒ«:</label>
                    <input type="file" id="workflow-file" accept=".json">
                </div>
                <button class="btn btn-success" onclick="uploadWorkflow()">ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
                <div id="upload-status"></div>
            </div>
        </div>

        <!-- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§ãƒ»ç¿»è¨³å®Ÿè¡Œ -->
        <div class="card" id="translation-section" style="display: none;">
            <div class="card-header">
                <h3>ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç¿»è¨³</h3>
            </div>
            <div class="card-body">
                <button class="btn" onclick="loadWorkflows()">ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§å–å¾—</button>
                <div id="workflows-status"></div>
                <div id="workflows-list" style="margin-top: 20px;"></div>
                
                <!-- ç¿»è¨³å®Ÿè¡Œãƒ•ã‚©ãƒ¼ãƒ  -->
                <div id="translation-form" style="display: none; margin-top: 20px; border: 1px solid #ddd; padding: 20px; border-radius: 5px;">
                    <h4>ç¿»è¨³è¨­å®š</h4>
                    <div class="form-group">
                        <label>ç¿»è¨³å…ˆè¨€èª:</label>
                        <select id="target-language">
                            <option value="ja">æ—¥æœ¬èª</option>
                            <option value="zh">ä¸­å›½èª</option>
                            <option value="ko">éŸ“å›½èª</option>
                            <option value="es">ã‚¹ãƒšã‚¤ãƒ³èª</option>
                            <option value="fr">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
                            <option value="de">ãƒ‰ã‚¤ãƒ„èª</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³:</label>
                        <select id="translation-engine">
                            <option value="google">Google Translate</option>
                            <option value="deepl">DeepL</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="executeTranslation()">ç¿»è¨³å®Ÿè¡Œ</button>
                    <button class="btn" onclick="closeTranslationForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <div id="translation-execute-status"></div>
                </div>
            </div>
        </div>

        <!-- ç¿»è¨³çµæœè¡¨ç¤º -->
        <div class="card" id="translation-results" style="display: none;">
            <div class="card-header">
                <h3>ğŸ“‹ ç¿»è¨³çµæœ</h3>
            </div>
            <div class="card-body">
                <button class="btn" onclick="loadTranslations()">ç¿»è¨³å±¥æ­´å–å¾—</button>
                <div id="translations-status"></div>
                <div id="translations-list" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3002';
        let currentToken = null;

        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testAPI() {
            try {
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                showStatus('api-status', 'APIã‚µãƒ¼ãƒãƒ¼æ¥ç¶šæˆåŠŸ', 'success');
                document.getElementById('api-result').style.display = 'block';
                document.getElementById('api-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                showStatus('api-status', `APIæ¥ç¶šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ã‚µãƒãƒ¼ãƒˆè¨€èªå–å¾—
        async function testLanguages() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/translations/languages/supported`);
                const data = await response.json();
                showStatus('api-status', 'ã‚µãƒãƒ¼ãƒˆè¨€èªå–å¾—æˆåŠŸ', 'success');
                document.getElementById('api-result').style.display = 'block';
                document.getElementById('api-result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                showStatus('api-status', `è¨€èªå–å¾—å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
        async function registerUser() {
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;

            if (!username || !email || !password) {
                showStatus('register-status', 'ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();
                if (response.ok) {
                    currentToken = data.accessToken;
                    showStatus('register-status', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æˆåŠŸï¼', 'success');
                    document.getElementById('profile-section').style.display = 'block';
                    document.getElementById('upload-section').style.display = 'block';
                    document.getElementById('translation-section').style.display = 'block';
                    document.getElementById('translation-results').style.display = 'block';
                } else {
                    showStatus('register-status', `ç™»éŒ²å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('register-status', `ç™»éŒ²ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³
        async function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showStatus('login-status', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (response.ok) {
                    currentToken = data.accessToken;
                    showStatus('login-status', 'ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                    document.getElementById('profile-section').style.display = 'block';
                    document.getElementById('upload-section').style.display = 'block';
                    document.getElementById('translation-section').style.display = 'block';
                    document.getElementById('translation-results').style.display = 'block';
                } else {
                    showStatus('login-status', `ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('login-status', `ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
        async function getProfile() {
            if (!currentToken) {
                showStatus('profile-status', 'ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/profile`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('profile-status', 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—æˆåŠŸ', 'success');
                    document.getElementById('profile-result').style.display = 'block';
                    document.getElementById('profile-result').textContent = JSON.stringify(data, null, 2);
                } else {
                    showStatus('profile-status', `å–å¾—å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('profile-status', `ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        async function uploadWorkflow() {
            if (!currentToken) {
                showStatus('upload-status', 'ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const fileInput = document.getElementById('workflow-file');
            const file = fileInput.files[0];

            if (!file) {
                showStatus('upload-status', 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`${API_BASE}/api/v1/workflows/upload`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${currentToken}` },
                    body: formData
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('upload-status', 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸï¼', 'success');
                    document.getElementById('translation-section').style.display = 'block';
                    document.getElementById('translation-results').style.display = 'block';
                } else {
                    showStatus('upload-status', `ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('upload-status', `ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§å–å¾—
        async function loadWorkflows() {
            if (!currentToken) {
                showStatus('workflows-status', 'ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/workflows`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('workflows-status', `${data.workflows.length}ä»¶ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å–å¾—`, 'success');
                    displayWorkflows(data.workflows);
                } else {
                    showStatus('workflows-status', `å–å¾—å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('workflows-status', `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¡¨ç¤º
        function displayWorkflows(workflows) {
            const listElement = document.getElementById('workflows-list');
            if (workflows.length === 0) {
                listElement.innerHTML = '<p>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            const workflowsHtml = workflows.map(workflow => `
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>${workflow.originalFilename}</h5>
                    <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${getStatusLabel(workflow.status)}</p>
                    <p><strong>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚:</strong> ${new Date(workflow.createdAt).toLocaleString('ja-JP')}</p>
                    <p><strong>æŠ½å‡ºãƒ†ã‚­ã‚¹ãƒˆæ•°:</strong> ${workflow.extractedTexts ? workflow.extractedTexts.length : 0}å€‹</p>
                    <button class="btn btn-success" onclick="startTranslation('${workflow.id}', '${workflow.originalFilename}')">
                        æ—¥æœ¬èªã«ç¿»è¨³
                    </button>
                </div>
            `).join('');

            listElement.innerHTML = workflowsHtml;
        }

        let selectedWorkflowId = null;

        // ç¿»è¨³é–‹å§‹
        function startTranslation(workflowId, filename) {
            selectedWorkflowId = workflowId;
            document.getElementById('translation-form').style.display = 'block';
            showStatus('translation-execute-status', `ã€Œ${filename}ã€ã®ç¿»è¨³è¨­å®š`, 'success');
        }

        // ç¿»è¨³ãƒ•ã‚©ãƒ¼ãƒ é–‰ã˜ã‚‹
        function closeTranslationForm() {
            document.getElementById('translation-form').style.display = 'none';
            selectedWorkflowId = null;
        }

        // ç¿»è¨³å®Ÿè¡Œ
        async function executeTranslation() {
            if (!currentToken || !selectedWorkflowId) {
                showStatus('translation-execute-status', 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            const targetLanguage = document.getElementById('target-language').value;
            const translationEngine = document.getElementById('translation-engine').value;

            try {
                const response = await fetch(`${API_BASE}/api/v1/translations/execute`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        workflowId: selectedWorkflowId,
                        targetLanguage: targetLanguage,
                        translationEngine: translationEngine
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('translation-execute-status', 'ç¿»è¨³å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ç¿»è¨³å±¥æ­´ã§é€²æ—ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'success');
                    closeTranslationForm();
                    setTimeout(() => loadTranslations(), 2000);
                } else {
                    showStatus('translation-execute-status', `ç¿»è¨³é–‹å§‹å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('translation-execute-status', `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ç¿»è¨³å±¥æ­´å–å¾—
        async function loadTranslations() {
            if (!currentToken) {
                showStatus('translations-status', 'ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/translations`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();
                if (response.ok) {
                    showStatus('translations-status', `${data.translations.length}ä»¶ã®ç¿»è¨³å±¥æ­´ã‚’å–å¾—`, 'success');
                    displayTranslations(data.translations);
                } else {
                    showStatus('translations-status', `å–å¾—å¤±æ•—: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('translations-status', `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ç¿»è¨³å±¥æ­´è¡¨ç¤º
        function displayTranslations(translations) {
            const listElement = document.getElementById('translations-list');
            if (translations.length === 0) {
                listElement.innerHTML = '<p>ç¿»è¨³å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            const translationsHtml = translations.map(translation => `
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>ç¿»è¨³ID: ${translation.id}</h5>
                    <p><strong>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ID:</strong> ${translation.workflowId}</p>
                    <p><strong>ç¿»è¨³å…ˆè¨€èª:</strong> ${getLanguageLabel(translation.targetLanguage)}</p>
                    <p><strong>ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³:</strong> ${getEngineLabel(translation.translationEngine)}</p>
                    <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> <span class="status ${getStatusClass(translation.status)}">${getTranslationStatusLabel(translation.status)}</span></p>
                    <p><strong>å“è³ªã‚¹ã‚³ã‚¢:</strong> ${translation.qualityScore ? translation.qualityScore + '%' : 'N/A'}</p>
                    <p><strong>ä½œæˆæ—¥æ™‚:</strong> ${new Date(translation.createdAt).toLocaleString('ja-JP')}</p>
                    ${translation.status === 'completed' ? 
                        `<button class="btn" onclick="downloadTranslation('${translation.id}')">ç¿»è¨³æ¸ˆã¿ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>` : ''
                    }
                </div>
            `).join('');

            listElement.innerHTML = translationsHtml;
        }

        // ç¿»è¨³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        async function downloadTranslation(translationId) {
            if (!currentToken) {
                showStatus('translations-status', 'ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/translations/${translationId}/download`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `translated_workflow_${translationId}.json`;
                    document.body.appendChild(link);
                    link.click();
                    link.remove();
                    window.URL.revokeObjectURL(url);
                    showStatus('translations-status', 'ç¿»è¨³æ¸ˆã¿ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
                } else {
                    showStatus('translations-status', 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showStatus('translations-status', `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function getStatusLabel(status) {
            const statusMap = {
                uploaded: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿',
                analyzing: 'è§£æä¸­',
                analyzed: 'è§£æå®Œäº†',
                translating: 'ç¿»è¨³ä¸­',
                translated: 'ç¿»è¨³å®Œäº†',
                failed: 'ã‚¨ãƒ©ãƒ¼'
            };
            return statusMap[status] || status;
        }

        function getTranslationStatusLabel(status) {
            const statusMap = {
                pending: 'å¾…æ©Ÿä¸­',
                processing: 'å‡¦ç†ä¸­',
                completed: 'å®Œäº†',
                failed: 'ã‚¨ãƒ©ãƒ¼'
            };
            return statusMap[status] || status;
        }

        function getStatusClass(status) {
            return status === 'completed' ? 'success' : status === 'failed' ? 'error' : 'default';
        }

        function getLanguageLabel(code) {
            const languageMap = {
                ja: 'æ—¥æœ¬èª',
                en: 'è‹±èª',
                zh: 'ä¸­å›½èª',
                ko: 'éŸ“å›½èª',
                es: 'ã‚¹ãƒšã‚¤ãƒ³èª',
                fr: 'ãƒ•ãƒ©ãƒ³ã‚¹èª',
                de: 'ãƒ‰ã‚¤ãƒ„èª'
            };
            return languageMap[code] || code;
        }

        function getEngineLabel(engine) {
            return engine === 'google' ? 'Google Translate' : 'DeepL';
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šï¼ˆæ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ï¼‰
            document.getElementById('reg-username').value = 'newuser';
            document.getElementById('reg-email').value = 'newuser@example.com';
            document.getElementById('reg-password').value = 'password123';
            document.getElementById('login-email').value = 'test@example.com';
            document.getElementById('login-password').value = 'password123';
        };
    </script>
</body>
</html>